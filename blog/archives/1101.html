<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head profile="http://purl.org/NET/erdf/profile">
    <META http-equiv="Content-Type" content="text/html; charset=utf-16">
    <title>
					mca blog
					
									[designing a RESTBucks media-type]
								</title>
    <link rel="alternate" type="application/x-wiki" title="Edit this blog" href="http://amundsen.com/blog/edit/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for mca blog" href="../feed/index.html">
    <link rel="stylesheet" type="text/css" href="http://amundsen.com/server/conflate/?/xcs/blogging/css/blogging.css,/xcs/blogging/css/blogging-layout.css,/xcs/blogging/css/blogging-iran-election.css">
    <link rel="search" type="application/opensearchdescription+xml" title="MikeAmundsen and friends" href="http://wego-wego.appspot.com/friendfeed/mamund/osd/">
    <link rel="schema.rdfs" href="http://www.w3.org/2000/01/rdf-schema#">
    <link rel="schema.dc" href="http://purl.org/dc/elements/1.1/">
    <link rel="schema.foaf" href="http://xmlns.com/foaf/0.1/">
    <link rel="schema.bio" href="http://vocab.org/bio/0.1/">
    <link rel="schema.contact" href="http://www.w3.org/2000/10/swap/pim/contact#">
    <link rel="schema.air" href="http://www.daml.org/2001/10/html/airport-ont#">
    <link rel="schema.wn" href="http://xmlns.com/wordnet/1.6/">
    <link rel="schema.rss" href="http://purl.org/rss/1.0/">
    <link rel="schema.terms" href="http://purl.org/dc/terms/">
    <link rel="schema.rel" href="http://purl.org/vocab/relationship/">
    <link rel="schema.geo" href="http://www.w3.org/2003/01/geo/wgs84_pos#">
    <link rel="schema.aff" href="http://purl.org/vocab/affiliations/0.1/">
    <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
    <link rel="schema.org" href="http://purl.org/vocab/organizations/0.1/">
    <link rel="schema.psych" href="http://purl.org/vocab/psychometric-profile/">
    <link rel="schema.doap" href="http://usefulinc.com/ns/doap#">
    <style type="text/css">
					form
					{
					font-size:small;
					padding:.3em;
					text-align:center;
					}
					input
					{
					font-size:x-small;
					}
					#twitter_div
					{
					/*
					width:95%
					padding:.2em;
					border:1px solid black;
					*/
					}
					#twitter_div h2
					{
					margin:0;
					padding:0;
					float:right;
					}
					.twitter-title
					{

					}
					#twitter_update_list
					{
					font-family:monospace;
					list-style:none;
					margin:0;
					padding:0;
					float:none;
					clear:both;
					}
					#twitter_update_list li
					{
					border:1px solid silver;
					background-color:#e6e6e6;
					margin:.2em .2em;
					}
					.twitter-link
					{
					display:block;
					float:right;
					margin-right: .7em;
					}
					#twitter_div a
					{
					text-decoration:none;
					}
					#twitter_div a:hover
					{
					text-decoration:underline;
					}
					.empty
					{
					float:none;
					clear:both;
					visibility:hidden;
					margin:0;
					padding:0;
					}
				</style><script type="text/javascript" src="http://amundsen.com/server/conflate/?/xcs/blogging/scripts/blogging.js,/lib/jscap/jcap.js,/lib/jscap/md5.js">//</script></head>
  <body>
    <div id="wrap">
      <div id="header">
        <h1><a href="../index.html" title="home page">mca blog</a></h1>
        <p class="title-desc">life in lowercase</p>
      </div>
      <div id="nav">
        <ul>
          <li><a href="../index.html" title="home page">Home</a></li>
          <li><a href="../categories/index.html" title="blog categories">Categories</a></li>
          <li><a href="../websites/index.html" title="intersting web sites">Web Sites</a></li>
          <li><a href="index.html" title="browse the archives">Archives</a></li>
        </ul>
      </div>
      <div id="main">
        <h2 class="dc-title">designing a RESTBucks media-type</h2>
        <div class="weblog">
          <div class="wb-header"><span class="foaf-maker" style="display:none;"><a href="http://www.amundsen.com/blog/author/mamund" title="Posted by mamund">mamund</a></span><span class="logdate" style="margin-left:1em;">2011-06-14 @ 08:32</span><span class="permalink"><a href="1101.html" title="perma-link">#</a></span></div>
          <div class="dc-description"><p>
<a href="http://www.flickr.com/photos/42076226@N04/4968246289/" title="Starbucks">
  <img src="http://farm5.static.flickr.com/4085/4968246289_25d8f3157d_t.jpg" align="right" class="inline" />
</a>
i've been spending the last several months experimenting w/ a repeatable methodology for
expressing business processes as media types for dist-net implementations (aka "the Web").
this blog post is one of a series i've been doing over the last year or so as i attempt
to improve upon these patterns and practices.
</p>
<h4>the RESTBucks example</h4>
<p>
the book <a href="http://oreilly.com/catalog/9780596805838" title="REST in Practice">REST in Practice</a> 
uses a very effective demonstration app
called RESTBucks to illustrate the authors' ideas on how to build RESTful solutions. the
book is one of three (along with 
<a href="http://oreilly.com/catalog/9780596529260/" title="RESTful Web Services">RESTful Web Services</a> and
<a href="http://oreilly.com/catalog/9780596801694/" title="RESTful Web Services Cookbook">The RESTful Web Services Cookbook</a>)
i highly recommend for those interested in applying the REST style. i like the 'RiP' book 
for a number of reasons. one of them is that the problem domain used for the example (RESTbucks) is
both simple enough to grasp and complex enough to be non-trivial. IMO, this makes for
a great teaching tool when discussing REST, Hypermedia, and dist-net architectures.
</p>
<blockquote>
  along with the code examples supplied in the book,
  i know of two additional RESTbucks implementations available right now:
  <a href="http://restbuckson.net/">http://restbuckson.net/</a> and
  <a href="https://github.com/SzymonPobiega/restbucks-wcf">https://github.com/SzymonPobiega/restbucks-wcf</a>. 
  there may be more, too!
</blockquote>
<h4>the hypermedia way</h4>
<p>for this blog post, i've commandeered the RESTBucks examples from REST in Practice in order
to illustrate a simple methodology for expressing application domain details as hypermedia types
in a way that works for HTTP and the Web. keep in mind this is my own interpretation of the RESTbucks
example and is not meant to indicate the endorsement or approval of the authors of REST in Practice.
</p>
<blockquote>
  the material that follows is based on content from a new book i am working on entitled
  "<a href="http://oreilly.com/catalog/0636920020530/">Building Hypermedia APIs with HTML5 and Node</a>" 
  that will be released later this year.
</blockquote>
<p>
i currently approach the process of implementing RESTful solutions differently than the 
authors of REST in Practice. i favor crafting a media-type that can express
the application domain, state transitions, and process flow as required. from my POV, this
allows me to focus only on the message sent between parties and ignore the implementation
details of any particular platform, framework, programming language, etc. in theory, this
results in an 'cross-platform' design that can be successfully implemented using any framework.
more over, the resulting client and server solutions should be able to successfully interact
with each other regardless of the implementation deatils since they all are aimed at support 
the media type w/ high fidelity and are not concerned about the *way* in which it is expressed 
(e.g. the implementation details specific to any language, etc.).
</p>
<h4>the Methodology</h4>
<p>
  in its current form, my methodology for designing a hypermedia type for an identified problem domain has four key parts:
</p>
<ol>
  <li>Select a Format (XML, JSON, HTML, etc.)</li>
  <li>Select a Domain Style (Specific, General, Agnostic)</li>
  <li>Select a State Transition Style (Read-only, Predefined, Ad-Hoc)</li>
  <li>Select a Process Flow Style (None, Embedded, Applied)</li>
</ol>
<p>
  since this is a blog post, i won't dwell to much on the above list except to say that, for the RESTbucks example, 
  i have settled the following for my design:
</p>
<table width="100%" border="1" cellpadding="4" cellspacing="0">
  <tr>
    <td>Format</td>
    <td>XML</td>
    <td>it's the style used for the RESTBucks examples in the book.</td>
  </tr>
  <tr>
    <td>Domain Style</td>
    <td>Specific</td>
    <td>it's similar to the style used in the book</td>
  </tr>
  <tr>
    <td>Transition Style</td>
    <td>Predefined</td>
    <td>the data supplied for each transition is spelled out in the docs and does not seem to require much flexibility</td>
  </tr>
  <tr>
    <td>Process Flow Style</td>
    <td>Embedded</td>
    <td>the process flow is well-established in the docs and can be mapped directly to @rels within the format</td>
  </tr>
</table>
<p>
  all these design choices are <i>arbitrary</i> and are driven mostly by my desire to keep the example in this blog relatively clean and simple.
</p>
<p>
  once the design choices are made, there is the work of identifying the <i>states</i> that need to be represented and the
  <i>transitions</i> that need to be supported. these are found by scanning the narrative of the problem domain just as in 
  any other process of translating 'real-world' use cases into something developers can convert into computing services.
</p>
<h4>the States</h4>
<p>
first, let's consider the states that need to be expressed for the RESTbucks example. i've settled
on two for this illustration: the set of orders(<code>list</code>), and a single order (<code>detail</code>).
</p>
<p>these two states will need to be expressed in a document. here's a simplistic example:</p>
<pre class="code">
&lt;rest-bucks version="1.0"&gt;
  &lt;order-list&gt;
    &lt;order&gt;
      &lt;status /&gt;
      &lt;location /&gt;
      &lt;cost /&gt;
      &lt;items&gt;
        &lt;item&gt;
          &lt;name /&gt;
          &lt;quantity /&gt;
          &lt;milk /&gt;
          &lt;size /&gt;
        &lt;/item&gt;
        ...
    &lt;/order&gt;
    ...
  &lt;/order-list&gt;
&lt;/rest-bucks&gt;
</pre>
<p>
you'll notice that this document can express both a set of orders and a single order. you'll also notice there
are no links in this representation. i left them out for clarity (and effect[g]).
</p>
<h4>the Transitions</h4>
<p>
a cursory review of the RESTbucks scenario leads me to identify the following state transitions:
</p>
<ol>
<li>get a list of orders</li>
<li>get an order detail</li>
<li>place an order</li>
<li>cancel an order</li>
<li>update an order</li>
<li>pay for an order</li>
<li>accept an order</li>
<li>reject an order</li>
<li>prepare an order</li>
<li>deliver an order</li>
</ol>
<p>
i may have missed a few or mis-represented some details of the transitions, but i think you get the idea.
</p>
<p>
so the RESTBucks representation i have in mind now has a number of possible links:
</p>
<pre class="code">
&lt;rest-bucks version="1.0"&gt;
  &lt;link rel="place" href="..." /&gt;
  &lt;link rel="list" href="..." /&gt;
  &lt;order-list&gt;
    &lt;order&gt;
      &lt;link rel="detail" href="..." /&gt;
      &lt;link rel="update" href="..." /&gt;
      &lt;link rel="cancel" href="..." /&gt;
      &lt;link rel="payment" href="..." /&gt;
      &lt;link rel="accept" href="..." /&gt;
      &lt;link rel="reject" href="..." /&gt;
      &lt;link rel="prepare" href="..." /&gt;
      &lt;link rel="deliver" href="..." /&gt;
      &lt;status /&gt;
      &lt;location /&gt;
      &lt;cost /&gt;
      &lt;items&gt;
        &lt;item&gt;
          &lt;name /&gt;
          &lt;quantity /&gt;
          &lt;milk /&gt;
          &lt;size /&gt;
        &lt;/item&gt;
        ...
    &lt;/order&gt;
    ...
  &lt;/order-list&gt;
&lt;/rest-bucks&gt;
</pre>
<p>
  first, note that some links appear at the top of the document (<code>list</code> and <code>place</code>)
  and some appear only within a single <code>order</code> element. that means some of these links could
  appear multiple times within the same response.
  also, not all the links shown above would appear in a <i>single</i> representation. but certainly more
  than one of them could appear in the same representation. for example, once an order has been successfully
  created, the representation sent to the user who created the order would likely include the following 
  transition options:
</p>
<ol>
  <li>list</li>
  <li>detail</li>
  <li>update</li>
  <li>cancel</li>
  <li>payment</li>
</ol>
<p>
  you'll also notice that none of the links contain actual URIs. the value of the <code>href</code> is of no
  consquence to <i>clients</i>; they will treat the URI as an opaque string. this allows each individual server
  implementation to chose the URI details that best fit that implementation. many frameworks are rather
  restrictive in how URIs must be constructed in order for servers to properly route and process the 
  requests. quality media type designs allow servers to do whatever is necessary in order to
  handle the request properly.
</p>
<h4>representing the Transitions</h4>
<p>
there are a number of ways to represent the actual state transitions. some of them are simple links. others
require added parameters; they could be viewed as 'link templates' or 'forms.' in my current experience, the act of
deciding on how the state transitions are rendered in the responses is one of the most contentious aspects
of design for a dev team. there are
those who want to use existing technologies to express 'inline' state transitions (HTML FORM, XFORM, etc.). there are
some who want to use these same technologies but keep the transition representations as separate resources (ala Rails).
there are some who want to design custom payloads using XML, JSON, etc. and simply document them w/o passing the
details in the responses (ala Atom). 
</p>
<p>
in my mind, these are <i>design</i> choices that people are free to make. as long as the work is consistent and the team
agrees to the pattern, there is no appreciable advantages or drawbacks to adopting one of these patterns over the other.
</p>
<blockquote>
  <p>
  <b>NOTE:</b> for the sake of brevity here, let's assume all successful state transitions return a response that is
  one of the following:
  </p>
<ol>
  <li>an order list representation (200 OK)</li>
  <li>an order detail representation (200 OK)</li>
  <li>a redirect to either an order list or order detail representation (201 Created, 3xx)</li>
</ol>
</blockquote>
<p>
with the above as preface, here is my list of transition representations. in this case, i've used XML <code>link</code>
elements w/ annotations of the possible HTTP protocol methods. this format usually is enough to express the key
points to just about any developer group and lead them to crafting a final representation upon which they all can
agree.
</p>
<pre class="code">
  
&lt;!-- return a list of orders (HTTP GET) --&gt;
&lt;link rel="list" href="..." /&gt;

&lt;!-- get a single order detail (HTTP GET) --&gt;
&lt;link rel="get" href="..." /&gt; 

&lt;!-- place a new order (HTTP PUT/POST) --&gt;
&lt;link rel="place" href="..." &gt;
  &lt;name /&gt;
  &lt;quantity /&gt;
  &lt;milk /&gt;
  &lt;size /&gt;
&lt;/link&gt;

&lt;!-- update an existing order HTTP PUT/POST --&gt;
&lt;link rel="update" href="..." &gt;
  &lt;name /&gt;
  &lt;quantity /&gt;
  &lt;milk /&gt;
  &lt;size /&gt;
&lt;/link&gt;

&lt;!-- cancel an existing order (HTTP DELETE) --&gt;
&lt;link rel="cancel" href="..." /&gt; HTTP DELETE
&lt;!-- OR (HTTP POST) --&gt;
&lt;link rel="cancel" href="..."&gt;
  &lt;order-href /&gt;
&lt;/link&gt;

&lt;!-- pay for an existing order (HTTP POST/PUT/PATCH) --&gt;
&lt;link rel="pay" href="..."&gt; 
  &lt;account-number /&gt;
  &lt;amount /&gt;
&lt;/link&gt;

&lt;!-- accept an existing order (POST/PUT/PATCH) --&gt;
&lt;link rel="accept" href="..."&gt;
  &lt;order-href /&gt;
&lt;/link&gt;

&lt;!-- reject an existing order (POST/PUT/PATCH) --&gt;
&lt;link rel="reject" href="..."&gt;
  &lt;order-href /&gt;
&lt;/link&gt;

&lt;!-- prepare an existing order (POST/PUT/PATCH) --&gt;
&lt;link rel="prepare" href="..."&gt;
  &lt;order-href /&gt;
&lt;/link&gt;

&lt;!-- deliver an existing order (POST/PUT/PATCH) --&gt;
&lt;link rel="deliver" href="..."&gt;
  &lt;order-href /&gt;
&lt;/link&gt;
</pre>
<p>
you'll note that some of the transitions suggest more than one possible protocol method. the choice would be dependent upon
what state information the client has available and what the server supports. it's not likely that all of the 
possiblites would be valid, but it gives folks a chance to consider the alternatives and weigh the pros/cons of
each.
</p>
<h4>the details</h4>
<p>
there are lots of missing details here. data types, when certain transitions are valid/invalid, error-handling and
representation, access controls, which 'actors' in the domain can 'see' or 'do' which transtions and when, etc.
there may even need to be more states and transitions defined in order to have a more 'complete' expression
of the problem domain.
</p>
<p>
but these short-comings are relatively easy to resolve. additional iterations through the problem domain, 
adding/removing elements, attributes, etc. as needed, and so forth. 
</p>
<h4>the code</h4>
<p>
  oh yea, the code...
</p>
<p>
  once the media type (message format and content) is designed, servers and clients are free to do whatever work is
  need to "support" this media type. both parties (client and server) know what a valid document looks like, what
  links could possibly appear in a response representation, what parameters are needed when executing a state
  transition, etc.
</p>
<p>
  different platforms, frameworks, etc. will mean different implementation details; that's fine. as long as both
  parties continue to focus on the message format as the 'sole arbiter' of compliance, things will work out just
  fine. IOW, the media type is the 'contract' to which both parties adhere. 
  in my experience, this approach to the implementation step is a bit disconcerting to the dev team.
</p>
<p> 
  "You mean there are 'no rules?' We can do it however we wish? But what about proper URIs and agreed upon classes 
  and objects and all that?"
</p>
<p>
  once they start to actually code servers that emit valid messages and clients that recognize and 
  render state transition elements, dev teams usually get pretty charged up. it turns out to be 'easier than
  first thought' to code using a media type as the contract. server devs have the freedom to use whatever components
  and technologies they wish. they can even <i>change</i> these elements at any time as long as the server
  continues to emit valid messages. clients can be as creative as they wish in rendering the responses. 
  if the target client base is Web browsers, devs can start with simple HTML renderings, add support for
  async Ajax, switch to RIAs, etc. all as long as the client is implemented to always accept and process valid
  messages.  
</p>
<p>
  even more interesting, as time goes on, teams have the freedom to test new UIs, optimize servers in new ways, etc.
  without worry of upsetting the application ecosystem; <i>as long as all particpants stay focused on maintaining
  high fidelity support for the agreed media type|messages</i>.
</p>
<h4>and the point here is...?</h4>
<p>
the point of this exercise is to give folks some ideas on how to approach hypermedia implementations from a 
new perspective; that of the hypermedia messages passed between parties. not the private classes/objects, not 
the URIs, but the messages and the hypermedia within those messages.
</p>
<p>
my experience to date is that this approach works regardless of the technology used by a team. 
it also often makes implementing hypermedia clearer, easier to grasp by all participants and, in many cases, 
results in a more flexible and stable solution that can safely evolve over time.
</p></div>
          <p class="category"><a href="index.html%3Fcategory=20.html" title="more from Hypermedia...">Hypermedia</a></p>
          <hr><a id="comments"></a><script>
						var idcomments_acct = 'b941b488f39712a0d6409992a0d7fc47';
						var idcomments_post_id;
						var idcomments_post_url;
					</script><span id="IDCommentsPostTitle" style="display:none"></span><script type="text/javascript" src="http://www.intensedebate.com/js/genericCommentWrapperV2.js"></script></div>
        <div> </div>
      </div>
      <div id="sidebar">
        <h4>categories</h4>
        <ul>
          <li><a href="index.html%3Fcategory=33.html">Systems</a></li>
          <li><a href="index.html%3Fcategory=32.html">CA</a></li>
          <li><a href="index.html%3Fcategory=31.html">IoT</a></li>
          <li><a href="index.html%3Fcategory=30.html">ALPS</a></li>
          <li><a href="index.html%3Fcategory=29.html">API</a></li>
          <li>[<a href="../categories/index.html%3Fall.html" title="view all categories">all</a>]</li>
        </ul>
        <h4>websites</h4>
        <ul>
          <li><a href="../websites/32.html">Untangled</a></li>
          <li><a href="../websites/31.html">Anne’s Weblog</a></li>
          <li><a href="../websites/30.html">exyus</a></li>
          <li><a href="../websites/29.html">Random Stuff</a></li>
          <li><a href="../websites/28.html">JScript Blog</a></li>
          <li>[<a href="../websites/index.html%3Fall.html" title="view all websites">all</a>]</li>
        </ul>
        <h4>archives</h4>
        <ul>
          <li><a href="index.html%3Ftoday.html" title="today's posts">today</a></li>
          <li><a href="index.html%3Fyesterday.html" title="yesterday's posts">yesterday</a></li>
          <li><a href="index.html%3Fthisweek.html" title="this weeks's posts">this week</a></li>
          <li><a href="index.html%3Flastweek.html" title="last week's posts">last week</a></li>
          <li><a href="index.html%3Fthismonth.html" title="this month's posts">this month</a></li>
          <li><a href="index.html%3Flastmonth.html" title="last month's posts">last month</a></li>
          <li>
								[<a href="index.html" title="browse the archives">browse</a>]
							</li>
        </ul>
        <div> </div>
        <div><xscript type="text/javascript" src="http://plancast.com/goodies/widgets/sidebar/1/15731">// plancast</xscript></div>
        <div id="twitter_div">
          <h4>my tweets</h4>
          <ul id="twitter_update_list"></ul>
          <div class="twitter-link"><a href="http://twitter.com/mamund" title="follow me on Twitter">
									follow me
								</a></div>
          <hr class="empty">
        </div>
      </div>
      <div id="ads" style="text-align:center;"><script type="text/javascript">
							google_ad_client = "pub-2944238157647009";
							google_ad_width = 728;
							google_ad_height = 90;
							google_ad_format = "728x90_as";
							google_ad_type = "text";
							//2007-08-10: amundsen.com
							google_ad_channel = "2960096544";
							google_color_border = "000000";
							google_color_bg = "F0F0F0";
							google_color_link = "000000";
							google_color_text = "000000";
							google_color_url = "000000";
						</script><script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script></div>
      <div id="footer">
        <p>Copyright © 2007-2010 amundsen.com, inc. All rights reserved.</p>
      </div>
    </div><script type="text/javascript" src="http://twitter.com/javascripts/blogger.js"></script><script type="text/javascript" src="http://twitter.com/statuses/user_timeline/mamund.json?callback=twitterCallback2&amp;count=5"></script><script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
					_uacct = "UA-2399548-1";
					urchinTracker();
				</script></body>
</html>